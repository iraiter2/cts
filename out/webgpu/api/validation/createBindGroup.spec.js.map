{"version":3,"sources":["../../../../src/webgpu/api/validation/createBindGroup.spec.ts"],"names":["description","poptions","params","makeTestGroup","unreachable","kBindingTypes","kBindingTypeInfo","kBindableResources","kTextureUsages","kTextureBindingTypes","kTextureBindingTypeInfo","ValidationTest","clone","descriptor","JSON","parse","stringify","g","test","fn","t","bindGroupLayout","device","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","COMPUTE","type","goodDescriptor","resource","buffer","getStorageBuffer","layout","createBindGroup","badDescriptor","expectValidationError","combine","bindingType","resourceType","info","storageTextureFormat","undefined","getBindingResource","resourceBindingMatches","usage","FRAGMENT","size","width","height","depth","format","shouldError","createTexture","createView","textureComponentType","GPUTextureUsage","SAMPLED","mismatchedTextureFormats","mismatchedTextureFormat","viewDimension","offset","_success","createBuffer","GPUBufferUsage","STORAGE"],"mappings":";;;;AAAA,OAAO,MAAMA,WAAW,GAAI;;CAArB;AAIP,SAASC,QAAT,EAAmBC,MAAnB,QAAiC,6CAAjC;AACA,SAASC,aAAT,QAA8B,yCAA9B;AACA,SAASC,WAAT,QAA4B,wCAA5B;AACA,SACEC,aADF,EAEEC,gBAFF,EAGEC,kBAHF,EAIEC,cAJF,EAKEC,oBALF,EAMEC,uBANF,QAOO,0BAPP;AASA,SAASC,cAAT,QAA+B,sBAA/B;;AAEA,SAASC,KAAT,CAA+CC,UAA/C,EAAiE;AAC/D,SAAOC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeH,UAAf,CAAX,CAAP;AACD;;AAED,OAAO,MAAMI,CAAC,GAAGd,aAAa,CAACQ,cAAD,CAAvB;AAEPM,CAAC,CAACC,IAAF,CAAO,wBAAP,EAAiCC,EAAjC,CAAoC,MAAMC,CAAN,IAAW;AAC7C,QAAMC,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcC,MAAAA,UAAU,EAAEC,cAAc,CAACC,OAAzC;AAAkDC,MAAAA,IAAI,EAAE;AAAxD,KAAD;AAD4C,GAA/B,CAAxB;AAIA,QAAMC,cAAc,GAAG;AACrBN,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAM,EAAEZ,CAAC,CAACa,gBAAF;AAAV;AAAxB,KAAD,CADY;AAErBC,IAAAA,MAAM,EAAEb;AAFa,GAAvB,CAL6C,CAU7C;;AACAD,EAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBL,cAAzB,EAX6C,CAa7C;;AACA,QAAMM,aAAa,GAAG;AACpBZ,IAAAA,OAAO,EAAE,CACP;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAM,EAAEZ,CAAC,CAACa,gBAAF;AAAV;AAAxB,KADO,EAEP;AACA;AAAER,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAM,EAAEZ,CAAC,CAACa,gBAAF;AAAV;AAAxB,KAHO,CADW;AAMpBC,IAAAA,MAAM,EAAEb;AANY,GAAtB;AASAD,EAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBC,aAAzB;AACD,GAFD;AAGD,CA1BD;AA4BAnB,CAAC,CAACC,IAAF,CAAO,mCAAP,EAA4CC,EAA5C,CAA+C,MAAMC,CAAN,IAAW;AACxD,QAAMC,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcC,MAAAA,UAAU,EAAEC,cAAc,CAACC,OAAzC;AAAkDC,MAAAA,IAAI,EAAE;AAAxD,KAAD;AAD4C,GAA/B,CAAxB;AAIA,QAAMC,cAAc,GAAG;AACrBN,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAM,EAAEZ,CAAC,CAACa,gBAAF;AAAV;AAAxB,KAAD,CADY;AAErBC,IAAAA,MAAM,EAAEb;AAFa,GAAvB,CALwD,CAUxD;;AACAD,EAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBL,cAAzB,EAXwD,CAaxD;;AACA,QAAMM,aAAa,GAAG;AACpBZ,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAM,EAAEZ,CAAC,CAACa,gBAAF;AAAV;AAAxB,KAAD,CADW;AAEpBC,IAAAA,MAAM,EAAEb;AAFY,GAAtB;AAKAD,EAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBC,aAAzB;AACD,GAFD;AAGD,CAtBD;AAwBAnB,CAAC,CAACC,IAAF,CAAO,4DAAP,EACGhB,MADH,CAEIA,MAAM,GACHoC,OADH,CACWrC,QAAQ,CAAC,aAAD,EAAgBI,aAAhB,CADnB,EAEGiC,OAFH,CAEWrC,QAAQ,CAAC,cAAD,EAAiBM,kBAAjB,CAFnB,CAFJ,EAMGY,EANH,CAMMC,CAAC,IAAI;AACP,QAAM;AAAEmB,IAAAA,WAAF;AAAeC,IAAAA;AAAf,MAAgCpB,CAAC,CAAClB,MAAxC;AACA,QAAMuC,IAAI,GAAGnC,gBAAgB,CAACiC,WAAD,CAA7B;AAEA,QAAMG,oBAAoB,GAAGD,IAAI,CAACV,QAAL,KAAkB,YAAlB,GAAiC,YAAjC,GAAgDY,SAA7E;AACA,QAAMT,MAAM,GAAGd,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AAC5CC,IAAAA,OAAO,EAAE,CACP;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcC,MAAAA,UAAU,EAAEC,cAAc,CAACC,OAAzC;AAAkDC,MAAAA,IAAI,EAAEU,WAAxD;AAAqEG,MAAAA;AAArE,KADO;AADmC,GAA/B,CAAf;AAMA,QAAMX,QAAQ,GAAGX,CAAC,CAACwB,kBAAF,CAAqBJ,YAArB,CAAjB;AAEA,QAAMK,sBAAsB,GAAGJ,IAAI,CAACV,QAAL,KAAkBS,YAAjD;AACApB,EAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AAAED,MAAAA,MAAF;AAAUV,MAAAA,OAAO,EAAE,CAAC;AAAEC,QAAAA,OAAO,EAAE,CAAX;AAAcM,QAAAA;AAAd,OAAD;AAAnB,KAAzB;AACD,GAFD,EAEG,CAACc,sBAFJ;AAGD,CAvBH;AAyBA5B,CAAC,CAACC,IAAF,CAAO,yCAAP,EACGhB,MADH,CAEIA,MAAM,GACHoC,OADH,CACWrC,QAAQ,CAAC,MAAD,EAASQ,oBAAT,CADnB,EAEG6B,OAFH,CAEWrC,QAAQ,CAAC,OAAD,EAAUO,cAAV,CAFnB,CAFJ,EAMGW,EANH,CAMM,MAAMC,CAAN,IAAW;AACb,QAAM;AAAES,IAAAA,IAAF;AAAQiB,IAAAA;AAAR,MAAkB1B,CAAC,CAAClB,MAA1B;AACA,QAAMuC,IAAI,GAAG/B,uBAAuB,CAACmB,IAAD,CAApC;AAEA,QAAMa,oBAAoB,GAAGD,IAAI,CAACV,QAAL,KAAkB,YAAlB,GAAiC,YAAjC,GAAgDY,SAA7E;AACA,QAAMtB,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcC,MAAAA,UAAU,EAAEC,cAAc,CAACoB,QAAzC;AAAmDlB,MAAAA,IAAnD;AAAyDa,MAAAA;AAAzD,KAAD;AAD4C,GAA/B,CAAxB;AAIA,QAAM7B,UAAU,GAAG;AACjBmC,IAAAA,IAAI,EAAE;AAAEC,MAAAA,KAAK,EAAE,EAAT;AAAaC,MAAAA,MAAM,EAAE,EAArB;AAAyBC,MAAAA,KAAK,EAAE;AAAhC,KADW;AAEjBC,IAAAA,MAAM,EAAE,YAFS;AAGjBN,IAAAA;AAHiB,GAAnB;AAMA,QAAMO,WAAW,GAAGP,KAAK,KAAKL,IAAI,CAACK,KAAnC;AACA1B,EAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AACvBX,MAAAA,OAAO,EAAE,CAAC;AAAEC,QAAAA,OAAO,EAAE,CAAX;AAAcM,QAAAA,QAAQ,EAAEX,CAAC,CAACE,MAAF,CAASgC,aAAT,CAAuBzC,UAAvB,EAAmC0C,UAAnC;AAAxB,OAAD,CADc;AAEvBrB,MAAAA,MAAM,EAAEb;AAFe,KAAzB;AAID,GALD,EAKGgC,WALH;AAMD,CA5BH;AA8BApC,CAAC,CAACC,IAAF,CAAO,0CAAP,EACGhB,MADH,CACUD,QAAQ,CAAC,sBAAD,EAAyB,CAAC,OAAD,EAAU,MAAV,EAAkB,MAAlB,CAAzB,CADlB,EAEGkB,EAFH,CAEM,MAAMC,CAAN,IAAW;AACb,QAAM;AAAEoC,IAAAA;AAAF,MAA2BpC,CAAC,CAAClB,MAAnC;AAEA,QAAMmB,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,OAAO,EAAE,CADX;AAEEC,MAAAA,UAAU,EAAEC,cAAc,CAACoB,QAF7B;AAGElB,MAAAA,IAAI,EAAE,iBAHR;AAIE2B,MAAAA;AAJF,KADO;AAD4C,GAA/B,CAAxB,CAHa,CAcb;;AACA,MAAIJ,MAAJ;;AACA,MAAII,oBAAoB,KAAK,OAA7B,EAAsC;AACpCJ,IAAAA,MAAM,GAAG,SAAT;AACD,GAFD,MAEO,IAAII,oBAAoB,KAAK,MAA7B,EAAqC;AAC1CJ,IAAAA,MAAM,GAAG,QAAT;AACD,GAFM,MAEA,IAAII,oBAAoB,KAAK,MAA7B,EAAqC;AAC1CJ,IAAAA,MAAM,GAAG,QAAT;AACD,GAFM,MAEA;AACLhD,IAAAA,WAAW,CAAC,mCAAD,CAAX;AACD;;AAED,QAAM0B,cAAc,GAAG;AACrBkB,IAAAA,IAAI,EAAE;AAAEC,MAAAA,KAAK,EAAE,EAAT;AAAaC,MAAAA,MAAM,EAAE,EAArB;AAAyBC,MAAAA,KAAK,EAAE;AAAhC,KADe;AAErBC,IAAAA,MAFqB;AAGrBN,IAAAA,KAAK,EAAEW,eAAe,CAACC;AAHF,GAAvB,CA1Ba,CAgCb;;AACAtC,EAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AACvBX,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,OAAO,EAAE,CADX;AAEEM,MAAAA,QAAQ,EAAEX,CAAC,CAACE,MAAF,CAASgC,aAAT,CAAuBxB,cAAvB,EAAuCyB,UAAvC;AAFZ,KADO,CADc;AAOvBrB,IAAAA,MAAM,EAAEb;AAPe,GAAzB;;AAUA,YAAUsC,wBAAV,GAAiE;AAC/D,QAAIH,oBAAoB,KAAK,OAA7B,EAAsC;AACpC,YAAM,SAAN;AACD;;AACD,QAAIA,oBAAoB,KAAK,MAA7B,EAAqC;AACnC,YAAM,QAAN;AACD;;AACD,QAAIA,oBAAoB,KAAK,MAA7B,EAAqC;AACnC,YAAM,QAAN;AACD;AACF,GArDY,CAuDb;;;AACA,OAAK,MAAMI,uBAAX,IAAsCD,wBAAwB,EAA9D,EAAkE;AAChE,UAAMvB,aAAmC,GAAGxB,KAAK,CAACkB,cAAD,CAAjD;AACAM,IAAAA,aAAa,CAACgB,MAAd,GAAuBQ,uBAAvB;AAEAxC,IAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,MAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AACvBX,QAAAA,OAAO,EAAE,CAAC;AAAEC,UAAAA,OAAO,EAAE,CAAX;AAAcM,UAAAA,QAAQ,EAAEX,CAAC,CAACE,MAAF,CAASgC,aAAT,CAAuBlB,aAAvB,EAAsCmB,UAAtC;AAAxB,SAAD,CADc;AAEvBrB,QAAAA,MAAM,EAAEb;AAFe,OAAzB;AAID,KALD;AAMD;AACF,CArEH,E,CAuEA;;AACAJ,CAAC,CAACC,IAAF,CAAO,qCAAP,EAA8CC,EAA9C,CAAiD,MAAMC,CAAN,IAAW;AAC1D,QAAMC,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,OAAO,EAAE,CADX;AAEEC,MAAAA,UAAU,EAAEC,cAAc,CAACoB,QAF7B;AAGElB,MAAAA,IAAI,EAAE,iBAHR;AAIEgC,MAAAA,aAAa,EAAE;AAJjB,KADO;AAD4C,GAA/B,CAAxB;AAWA,QAAM/B,cAAc,GAAG;AACrBkB,IAAAA,IAAI,EAAE;AAAEC,MAAAA,KAAK,EAAE,EAAT;AAAaC,MAAAA,MAAM,EAAE,EAArB;AAAyBC,MAAAA,KAAK,EAAE;AAAhC,KADe;AAErBC,IAAAA,MAAM,EAAE,YAFa;AAGrBN,IAAAA,KAAK,EAAEW,eAAe,CAACC;AAHF,GAAvB,CAZ0D,CAkB1D;;AACAtC,EAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AACvBX,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcM,MAAAA,QAAQ,EAAEX,CAAC,CAACE,MAAF,CAASgC,aAAT,CAAuBxB,cAAvB,EAAuCyB,UAAvC;AAAxB,KAAD,CADc;AAEvBrB,IAAAA,MAAM,EAAEb;AAFe,GAAzB,EAnB0D,CAwB1D;;AACA,QAAMe,aAAa,GAAGxB,KAAK,CAACkB,cAAD,CAA3B;AACAM,EAAAA,aAAa,CAACY,IAAd,CAAmBG,KAAnB,GAA2B,CAA3B;AAEA/B,EAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyB;AACvBX,MAAAA,OAAO,EAAE,CAAC;AAAEC,QAAAA,OAAO,EAAE,CAAX;AAAcM,QAAAA,QAAQ,EAAEX,CAAC,CAACE,MAAF,CAASgC,aAAT,CAAuBlB,aAAvB,EAAsCmB,UAAtC;AAAxB,OAAD,CADc;AAEvBrB,MAAAA,MAAM,EAAEb;AAFe,KAAzB;AAID,GALD;AAMD,CAlCD;AAoCAJ,CAAC,CAACC,IAAF,CAAO,8CAAP,EACGhB,MADH,CACU,CACN;AAAE4D,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAE,GAAnB;AAAwBe,EAAAA,QAAQ,EAAE;AAAlC,CADM,EACoC;AAC1C;AAAED,EAAAA,MAAM,EAAE,GAAV;AAAed,EAAAA,IAAI,EAAE,GAArB;AAA0Be,EAAAA,QAAQ,EAAE;AAApC,CAFM,EAEsC;AAE5C;AACA;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAE,IAAnB;AAAyBe,EAAAA,QAAQ,EAAE;AAAnC,CALM,EAMN;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAEL,SAAnB;AAA8BoB,EAAAA,QAAQ,EAAE;AAAxC,CANM,EAON;AAAED,EAAAA,MAAM,EAAE,MAAM,CAAhB;AAAmBd,EAAAA,IAAI,EAAE,GAAzB;AAA8Be,EAAAA,QAAQ,EAAE;AAAxC,CAPM,EAQN;AAAED,EAAAA,MAAM,EAAE,MAAM,CAAhB;AAAmBd,EAAAA,IAAI,EAAEL,SAAzB;AAAoCoB,EAAAA,QAAQ,EAAE;AAA9C,CARM,EAUN;AACA;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAE,CAAnB;AAAsBe,EAAAA,QAAQ,EAAE;AAAhC,CAXM,EAYN;AAAED,EAAAA,MAAM,EAAE,GAAV;AAAed,EAAAA,IAAI,EAAE,CAArB;AAAwBe,EAAAA,QAAQ,EAAE;AAAlC,CAZM,EAaN;AAAED,EAAAA,MAAM,EAAE,IAAV;AAAgBd,EAAAA,IAAI,EAAE,CAAtB;AAAyBe,EAAAA,QAAQ,EAAE;AAAnC,CAbM,EAcN;AAAED,EAAAA,MAAM,EAAE,IAAV;AAAgBd,EAAAA,IAAI,EAAEL,SAAtB;AAAiCoB,EAAAA,QAAQ,EAAE;AAA3C,CAdM,EAgBN;AACA;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAE,GAAnB;AAAwBe,EAAAA,QAAQ,EAAE;AAAlC,CAjBM,EAkBN;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAEL,SAAnB;AAA8BoB,EAAAA,QAAQ,EAAE;AAAxC,CAlBM,EAmBN;AAAED,EAAAA,MAAM,EAAE,GAAV;AAAed,EAAAA,IAAI,EAAE,GAArB;AAA0Be,EAAAA,QAAQ,EAAE;AAApC,CAnBM,EAoBN;AAAED,EAAAA,MAAM,EAAE,GAAV;AAAed,EAAAA,IAAI,EAAE,GAArB;AAA0Be,EAAAA,QAAQ,EAAE;AAApC,CApBM,EAsBN;AACA;AAAED,EAAAA,MAAM,EAAE,MAAM,CAAhB;AAAmBd,EAAAA,IAAI,EAAE,CAAzB;AAA4Be,EAAAA,QAAQ,EAAE;AAAtC,CAvBM,EAuByC;AAC/C;AAAED,EAAAA,MAAM,EAAE,CAAV;AAAad,EAAAA,IAAI,EAAE,MAAM,CAAzB;AAA4Be,EAAAA,QAAQ,EAAE;AAAtC,CAxBM,EAwByC;AAC/C;AAAED,EAAAA,MAAM,EAAE,IAAV;AAAgBd,EAAAA,IAAI,EAAE,CAAtB;AAAyBe,EAAAA,QAAQ,EAAE;AAAnC,CAzBM,CAyBsC;AAzBtC,CADV,EA4BG5C,EA5BH,CA4BM,MAAMC,CAAN,IAAW;AACb,QAAM;AAAE0C,IAAAA,MAAF;AAAUd,IAAAA,IAAV;AAAgBe,IAAAA;AAAhB,MAA6B3C,CAAC,CAAClB,MAArC;AAEA,QAAMmB,eAAe,GAAGD,CAAC,CAACE,MAAF,CAASC,qBAAT,CAA+B;AACrDC,IAAAA,OAAO,EAAE,CAAC;AAAEC,MAAAA,OAAO,EAAE,CAAX;AAAcC,MAAAA,UAAU,EAAEC,cAAc,CAACC,OAAzC;AAAkDC,MAAAA,IAAI,EAAE;AAAxD,KAAD;AAD4C,GAA/B,CAAxB;AAIA,QAAMG,MAAM,GAAGZ,CAAC,CAACE,MAAF,CAAS0C,YAAT,CAAsB;AACnChB,IAAAA,IAAI,EAAE,IAD6B;AAEnCF,IAAAA,KAAK,EAAEmB,cAAc,CAACC;AAFa,GAAtB,CAAf;AAKA,QAAMrD,UAAU,GAAG;AACjBW,IAAAA,OAAO,EAAE,CACP;AACEC,MAAAA,OAAO,EAAE,CADX;AAEEM,MAAAA,QAAQ,EAAE;AAAEC,QAAAA,MAAF;AAAU8B,QAAAA,MAAV;AAAkBd,QAAAA;AAAlB;AAFZ,KADO,CADQ;AAOjBd,IAAAA,MAAM,EAAEb;AAPS,GAAnB;;AAUA,MAAI0C,QAAJ,EAAc;AACZ;AACA3C,IAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBtB,UAAzB;AACD,GAHD,MAGO;AACL;AACAO,IAAAA,CAAC,CAACiB,qBAAF,CAAwB,MAAM;AAC5BjB,MAAAA,CAAC,CAACE,MAAF,CAASa,eAAT,CAAyBtB,UAAzB;AACD,KAFD;AAGD;AACF,CA3DH","sourcesContent":["export const description = `\ncreateBindGroup validation tests.\n`;\n\nimport { poptions, params } from '../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { unreachable } from '../../../common/framework/util/util.js';\nimport {\n  kBindingTypes,\n  kBindingTypeInfo,\n  kBindableResources,\n  kTextureUsages,\n  kTextureBindingTypes,\n  kTextureBindingTypeInfo,\n} from '../../capability_info.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nfunction clone<T extends GPUTextureDescriptor>(descriptor: T): T {\n  return JSON.parse(JSON.stringify(descriptor));\n}\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('binding_count_mismatch').fn(async t => {\n  const bindGroupLayout = t.device.createBindGroupLayout({\n    entries: [{ binding: 0, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' }],\n  });\n\n  const goodDescriptor = {\n    entries: [{ binding: 0, resource: { buffer: t.getStorageBuffer() } }],\n    layout: bindGroupLayout,\n  };\n\n  // Control case\n  t.device.createBindGroup(goodDescriptor);\n\n  // Another binding is not expected.\n  const badDescriptor = {\n    entries: [\n      { binding: 0, resource: { buffer: t.getStorageBuffer() } },\n      // Another binding is added.\n      { binding: 1, resource: { buffer: t.getStorageBuffer() } },\n    ],\n    layout: bindGroupLayout,\n  };\n\n  t.expectValidationError(() => {\n    t.device.createBindGroup(badDescriptor);\n  });\n});\n\ng.test('binding_must_be_present_in_layout').fn(async t => {\n  const bindGroupLayout = t.device.createBindGroupLayout({\n    entries: [{ binding: 0, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' }],\n  });\n\n  const goodDescriptor = {\n    entries: [{ binding: 0, resource: { buffer: t.getStorageBuffer() } }],\n    layout: bindGroupLayout,\n  };\n\n  // Control case\n  t.device.createBindGroup(goodDescriptor);\n\n  // Binding index 0 must be present.\n  const badDescriptor = {\n    entries: [{ binding: 1, resource: { buffer: t.getStorageBuffer() } }],\n    layout: bindGroupLayout,\n  };\n\n  t.expectValidationError(() => {\n    t.device.createBindGroup(badDescriptor);\n  });\n});\n\ng.test('buffer_binding_must_contain_exactly_one_buffer_of_its_type')\n  .params(\n    params()\n      .combine(poptions('bindingType', kBindingTypes))\n      .combine(poptions('resourceType', kBindableResources))\n  )\n  .fn(t => {\n    const { bindingType, resourceType } = t.params;\n    const info = kBindingTypeInfo[bindingType];\n\n    const storageTextureFormat = info.resource === 'storageTex' ? 'rgba8unorm' : undefined;\n    const layout = t.device.createBindGroupLayout({\n      entries: [\n        { binding: 0, visibility: GPUShaderStage.COMPUTE, type: bindingType, storageTextureFormat },\n      ],\n    });\n\n    const resource = t.getBindingResource(resourceType);\n\n    const resourceBindingMatches = info.resource === resourceType;\n    t.expectValidationError(() => {\n      t.device.createBindGroup({ layout, entries: [{ binding: 0, resource }] });\n    }, !resourceBindingMatches);\n  });\n\ng.test('texture_binding_must_have_correct_usage')\n  .params(\n    params()\n      .combine(poptions('type', kTextureBindingTypes))\n      .combine(poptions('usage', kTextureUsages))\n  )\n  .fn(async t => {\n    const { type, usage } = t.params;\n    const info = kTextureBindingTypeInfo[type];\n\n    const storageTextureFormat = info.resource === 'storageTex' ? 'rgba8unorm' : undefined;\n    const bindGroupLayout = t.device.createBindGroupLayout({\n      entries: [{ binding: 0, visibility: GPUShaderStage.FRAGMENT, type, storageTextureFormat }],\n    });\n\n    const descriptor = {\n      size: { width: 16, height: 16, depth: 1 },\n      format: 'rgba8unorm' as const,\n      usage,\n    };\n\n    const shouldError = usage !== info.usage;\n    t.expectValidationError(() => {\n      t.device.createBindGroup({\n        entries: [{ binding: 0, resource: t.device.createTexture(descriptor).createView() }],\n        layout: bindGroupLayout,\n      });\n    }, shouldError);\n  });\n\ng.test('texture_must_have_correct_component_type')\n  .params(poptions('textureComponentType', ['float', 'sint', 'uint'] as const))\n  .fn(async t => {\n    const { textureComponentType } = t.params;\n\n    const bindGroupLayout = t.device.createBindGroupLayout({\n      entries: [\n        {\n          binding: 0,\n          visibility: GPUShaderStage.FRAGMENT,\n          type: 'sampled-texture',\n          textureComponentType,\n        },\n      ],\n    });\n\n    // TODO: Test more texture component types.\n    let format: GPUTextureFormat;\n    if (textureComponentType === 'float') {\n      format = 'r8unorm';\n    } else if (textureComponentType === 'sint') {\n      format = 'r8sint';\n    } else if (textureComponentType === 'uint') {\n      format = 'r8uint';\n    } else {\n      unreachable('Unexpected texture component type');\n    }\n\n    const goodDescriptor = {\n      size: { width: 16, height: 16, depth: 1 },\n      format,\n      usage: GPUTextureUsage.SAMPLED,\n    };\n\n    // Control case\n    t.device.createBindGroup({\n      entries: [\n        {\n          binding: 0,\n          resource: t.device.createTexture(goodDescriptor).createView(),\n        },\n      ],\n      layout: bindGroupLayout,\n    });\n\n    function* mismatchedTextureFormats(): Iterable<GPUTextureFormat> {\n      if (textureComponentType !== 'float') {\n        yield 'r8unorm';\n      }\n      if (textureComponentType !== 'sint') {\n        yield 'r8sint';\n      }\n      if (textureComponentType !== 'uint') {\n        yield 'r8uint';\n      }\n    }\n\n    // Mismatched texture binding formats are not valid.\n    for (const mismatchedTextureFormat of mismatchedTextureFormats()) {\n      const badDescriptor: GPUTextureDescriptor = clone(goodDescriptor);\n      badDescriptor.format = mismatchedTextureFormat;\n\n      t.expectValidationError(() => {\n        t.device.createBindGroup({\n          entries: [{ binding: 0, resource: t.device.createTexture(badDescriptor).createView() }],\n          layout: bindGroupLayout,\n        });\n      });\n    }\n  });\n\n// TODO: Write test for all dimensions.\ng.test('texture_must_have_correct_dimension').fn(async t => {\n  const bindGroupLayout = t.device.createBindGroupLayout({\n    entries: [\n      {\n        binding: 0,\n        visibility: GPUShaderStage.FRAGMENT,\n        type: 'sampled-texture',\n        viewDimension: '2d',\n      },\n    ],\n  });\n\n  const goodDescriptor = {\n    size: { width: 16, height: 16, depth: 1 },\n    format: 'rgba8unorm' as const,\n    usage: GPUTextureUsage.SAMPLED,\n  };\n\n  // Control case\n  t.device.createBindGroup({\n    entries: [{ binding: 0, resource: t.device.createTexture(goodDescriptor).createView() }],\n    layout: bindGroupLayout,\n  });\n\n  // Mismatched texture binding formats are not valid.\n  const badDescriptor = clone(goodDescriptor);\n  badDescriptor.size.depth = 2;\n\n  t.expectValidationError(() => {\n    t.device.createBindGroup({\n      entries: [{ binding: 0, resource: t.device.createTexture(badDescriptor).createView() }],\n      layout: bindGroupLayout,\n    });\n  });\n});\n\ng.test('buffer_offset_and_size_for_bind_groups_match')\n  .params([\n    { offset: 0, size: 512, _success: true }, // offset 0 is valid\n    { offset: 256, size: 256, _success: true }, // offset 256 (aligned) is valid\n\n    // Touching the end of the buffer\n    { offset: 0, size: 1024, _success: true },\n    { offset: 0, size: undefined, _success: true },\n    { offset: 256 * 3, size: 256, _success: true },\n    { offset: 256 * 3, size: undefined, _success: true },\n\n    // Zero-sized bindings\n    { offset: 0, size: 0, _success: true },\n    { offset: 256, size: 0, _success: true },\n    { offset: 1024, size: 0, _success: true },\n    { offset: 1024, size: undefined, _success: true },\n\n    // Unaligned buffer offset is invalid\n    { offset: 1, size: 256, _success: false },\n    { offset: 1, size: undefined, _success: false },\n    { offset: 128, size: 256, _success: false },\n    { offset: 255, size: 256, _success: false },\n\n    // Out-of-bounds\n    { offset: 256 * 5, size: 0, _success: false }, // offset is OOB\n    { offset: 0, size: 256 * 5, _success: false }, // size is OOB\n    { offset: 1024, size: 1, _success: false }, // offset+size is OOB\n  ])\n  .fn(async t => {\n    const { offset, size, _success } = t.params;\n\n    const bindGroupLayout = t.device.createBindGroupLayout({\n      entries: [{ binding: 0, visibility: GPUShaderStage.COMPUTE, type: 'storage-buffer' }],\n    });\n\n    const buffer = t.device.createBuffer({\n      size: 1024,\n      usage: GPUBufferUsage.STORAGE,\n    });\n\n    const descriptor = {\n      entries: [\n        {\n          binding: 0,\n          resource: { buffer, offset, size },\n        },\n      ],\n      layout: bindGroupLayout,\n    };\n\n    if (_success) {\n      // Control case\n      t.device.createBindGroup(descriptor);\n    } else {\n      // Buffer offset and/or size don't match in bind groups.\n      t.expectValidationError(() => {\n        t.device.createBindGroup(descriptor);\n      });\n    }\n  });\n"],"file":"createBindGroup.spec.js"}